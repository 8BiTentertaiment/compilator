name: Build & Release Pre-release DLL

on:
  push:
    branches: [ main ] # Ð¸Ð»Ð¸ Ñ‚Ð²Ð¾Ñ Ð²ÐµÑ‚ÐºÐ°

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: ðŸ”½ Checkout ÐºÐ¾Ð´Ð°
      uses: actions/checkout@v4

    - name: ðŸ§° Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Rust toolchain
      uses: dtolnay/rust-toolchain@stable

    - name: ðŸ§± Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
      run: cargo build --release

    - name: ðŸ“ ÐÐ°Ð¹Ñ‚Ð¸ DLL
      id: find_dll
      shell: pwsh
      run: |
        $dll = Get-ChildItem -Path target/release -Filter *.dll | Select-Object -First 1
        echo "dll_path=$($dll.FullName)" >> $env:GITHUB_ENV

    - name: ðŸš€ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ pre-release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: pre-release
        name: "Auto Pre-release Build"
        prerelease: true
        files: ${{ env.dll_path }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
